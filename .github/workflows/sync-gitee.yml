name: Sync GitHub to Gitee

on:
  push:
  workflow_dispatch:

concurrency:
  group: sync-gitee-${{ github.repository }}
  cancel-in-progress: false

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validate required secrets
        env:
          GITEE_USER: ${{ secrets.GITEE_USER }}
          GITEE_REPO: ${{ secrets.GITEE_REPO }}
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
        run: |
          if [ -z "$GITEE_USER" ] || [ -z "$GITEE_REPO" ] || [ -z "$GITEE_TOKEN" ]; then
            echo "Missing one or more required secrets: GITEE_USER, GITEE_REPO, GITEE_TOKEN"
            exit 1
          fi

      - name: Push to Gitee
        env:
          GITEE_USER: ${{ secrets.GITEE_USER }}
          GITEE_REPO: ${{ secrets.GITEE_REPO }}
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
        run: |
          git remote remove gitee || true
          git remote add gitee "https://${GITEE_USER}:${GITEE_TOKEN}@gitee.com/${GITEE_REPO}.git"
          git push gitee --all --force
          git push gitee --tags --force
